{{ define "main" }}
{{ $urlParts := split .RelPermalink "/" }}
{{ $year := index $urlParts 2 }}
{{ $month := index $urlParts 3 }}

{{ if $month }}
  <h1>Posts from {{ $month }}/{{ $year }}</h1>
{{ else if and $year (ne $year "posts") }}
  <h1>Posts from {{ $year }}</h1>
{{ else }}
  <h1>Posts</h1>
{{ end }}

<div class="posts-list">
{{ $posts := where .Site.RegularPages "Section" "posts" }}
{{ $posts = $posts.ByDate.Reverse }}

{{ if $month }}
  {{ $yearInt := int $year }}
  {{ $monthInt := 0 }}
  {{ if eq $month "01" }}{{ $monthInt = 1 }}{{ end }}
  {{ if eq $month "02" }}{{ $monthInt = 2 }}{{ end }}
  {{ if eq $month "03" }}{{ $monthInt = 3 }}{{ end }}
  {{ if eq $month "04" }}{{ $monthInt = 4 }}{{ end }}
  {{ if eq $month "05" }}{{ $monthInt = 5 }}{{ end }}
  {{ if eq $month "06" }}{{ $monthInt = 6 }}{{ end }}
  {{ if eq $month "07" }}{{ $monthInt = 7 }}{{ end }}
  {{ if eq $month "08" }}{{ $monthInt = 8 }}{{ end }}
  {{ if eq $month "09" }}{{ $monthInt = 9 }}{{ end }}
  {{ if eq $month "10" }}{{ $monthInt = 10 }}{{ end }}
  {{ if eq $month "11" }}{{ $monthInt = 11 }}{{ end }}
  {{ if eq $month "12" }}{{ $monthInt = 12 }}{{ end }}
  {{ $posts = where $posts ".Date.Year" $yearInt }}
  {{ $posts = where $posts ".Date.Month" $monthInt }}
{{ else if and $year (ne $year "posts") }}
  {{ $yearInt := int $year }}
  {{ $posts = where $posts ".Date.Year" $yearInt }}
{{ end }}

{{ range $posts }}
  <div class="post">
    <p>
      <div class="date">{{ .PublishDate.Format "Jan. 2, 2006" }}</div>
      <h1><a href="{{ .Permalink }}" title="{{ .Title }}">{{ .Title }}</a></h1>
      {{ .Summary }}
    </p>
  </div>
{{ end }}

{{ if eq (len $posts) 0 }}
  <p>No posts found for this time period.</p>
{{ end }}
</div>

{{ end }}
